var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Background=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap;t.texture=RES.getRes("rmb_100_jpg"),t.width=Data.getStageW(),t.height=Data.getStageH(),this.addChild(t),this._txt=new egret.BitmapText,this._txt.font=RES.getRes("num_fnt"),this._txt.letterSpacing=5,this._txt.width=Data.getStageW(),this._txt.y=200,this._txt.text=Data.score.toString(),this.addChild(this._txt)},e.prototype.init_origin=function(){var t=new egret.Bitmap;t.texture=RES.getRes("sky_00_png"),t.width=Data.getStageW(),t.height=Data.getStageH(),this.addChild(t);var e=new egret.Bitmap;e.texture=RES.getRes("jousting_wall_png"),e.width=Data.getStageW(),e.y=Data.getStageH()-e.height/2,this.addChild(e);var i=new egret.Bitmap;i.texture=RES.getRes("turret_left_png"),i.x=-20,i.y=Data.getStageH()-i.height-50,this.addChildAt(i,1);var n=new egret.Bitmap;n.texture=RES.getRes("turret_right_png"),n.x=Data.getStageW()-n.width+20,n.y=Data.getStageH()-n.height-50,this.addChildAt(n,1);var s=new egret.Bitmap;s.texture=RES.getRes("ge_cannon_open_22_png"),s.x=i.x-5,s.y=i.y-s.height+60,this.addChild(s);var o=new egret.Bitmap;o.texture=RES.getRes("ge_cannon_open_22_png"),o.x=n.x-5,o.y=n.y-o.height+60,this.addChild(o),this._txt=new egret.BitmapText,this._txt.font=RES.getRes("num_fnt"),this._txt.letterSpacing=5,this._txt.width=Data.getStageW(),this._txt.y=200,this._txt.text=Data.score.toString(),this.addChild(this._txt)},e.prototype.update=function(){this._txt.text=Data.score.toString()},e}(egret.DisplayObjectContainer);__reflect(Background.prototype,"Background");var Data=function(){function t(){}return t.getStageW=function(){return egret.MainContext.instance.stage.stageWidth},t.getStageH=function(){return egret.MainContext.instance.stage.stageHeight},Object.defineProperty(t,"stage",{get:function(){return egret.MainContext.instance.stage},enumerable:!0,configurable:!0}),t}();Data.type=-1,Data.score=0,__reflect(Data.prototype,"Data");var FlyMan=function(t){function e(){var e=t.call(this)||this;return e._exp=!1,e._speed=0,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=RES.getRes("flyman_action_json"),e=RES.getRes("flyman_action_png");console.log("yes: ",e);var i=new egret.MovieClipDataFactory(t,e);this._man=new egret.MovieClip(i.generateMovieClipData("flyman")),this.addChild(this._man),this._balloon=new egret.Bitmap,this._balloon.y=-100,this.addChild(this._balloon),this._line=new egret.Shape,this._line.graphics.lineStyle(1,0),this._line.graphics.moveTo(0,0),this._line.graphics.lineTo(0,-90),this.addChildAt(this._line,0),this.addEventListener(egret.Event.ADDED,this.added,this),Data.stage.addEventListener("gameover",this.gameover,this),Data.stage.addEventListener("action",this.action,this)},e.prototype.added=function(t){this._exp=!1,this.x=100+Math.random()*(Data.getStageW()-200),this.y=-100,this._type=this.selectType(),this._balloon.texture=this.getBalloonTexture(),this._balloon.x=this._balloon.width/2*-1,this._man.play(-1),this.addChild(this._balloon),this.addChildAt(this._line,0),this._speed=2+4*Math.random(),this.addEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.move=function(t){this.y>=Data.getStageH()-80&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this),this._exp?(this.parent.removeChild(this),Data.stage.dispatchEvent(new egret.Event("earthquake"))):Data.stage.dispatchEvent(new egret.Event("gameover"))),this.y+=this._speed},e.prototype.selectType=function(){return Math.floor(6*Math.random())},e.prototype.getBalloonTexture=function(){switch(this._type){case 0:return RES.getRes("ge_balloon_V_png");case 1:return RES.getRes("ge_balloon_vert-line_png");case 2:return RES.getRes("ge_balloon_horiz-line_png");case 3:return RES.getRes("ge_balloon_delta_png");case 4:return RES.getRes("ge_balloon_gamma_png");case 5:return RES.getRes("ge_balloon_Z_png")}},e.prototype.gameover=function(t){this._man.stop(),this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.action=function(t){this._type==Data.type&&0==this._exp&&(this._exp=!0,this._speed=7,this.playBalloonMc(),Data.score++)},e.prototype.playBalloonMc=function(){this.removeChild(this._balloon),this.removeChild(this._line)},e}(egret.DisplayObjectContainer);__reflect(FlyMan.prototype,"FlyMan");var Game_BAK=function(){function t(t){this._layer=t,this.init()}return t.prototype.init=function(){this.drawBg(),this._gestureShape=new egret.Shape,this._layer.addChild(this._gestureShape),this._gesture=new Gesture,this._gesture.addEvent(this._gestureShape),Data.stage.addEventListener("gameover",this.gameover,this),Data.stage.addEventListener("earthquake",this.earthquake,this)},t.prototype.drawBg=function(){this._background=new Background,this._layer.addChild(this._background)},t.prototype.start=function(){this._time=new egret.Timer(3e3,0),this._time.addEventListener(egret.TimerEvent.TIMER,this.create,this),this._time.start()},t.prototype.create=function(t){var e=new FlyMan;this._layer.addChild(e)},t.prototype.gameover=function(t){this._time.stop(),this._gesture.removeEvent()},t.prototype.earthquake=function(t){this._background.update(),egret.Tween.get(this._layer).to({x:5,y:5},50).to({x:-5,y:5},50).to({x:5,y:-5},50).to({x:0,y:0},50)},t}();__reflect(Game_BAK.prototype,"Game_BAK");var Game=function(){function t(t){this._layer=t,this.init()}return t.prototype.init=function(){this.drawBg(),this._gestureShape=new egret.Shape,this._layer.addChild(this._gestureShape),this._gesture=new Gesture,this._gesture.addEvent(this._gestureShape),Data.stage.addEventListener("gameover",this.gameover,this),Data.stage.addEventListener("counter",this.counter,this)},t.prototype.drawBg=function(){this._background=new Background,this._maskBg=new Background,this._layer.addChild(this._background),this._layer.addChild(this._maskBg)},t.prototype.start=function(){this._time=new egret.Timer(3e3,0),this._time.addEventListener(egret.TimerEvent.TIMER,this.create,this),this._time.start()},t.prototype.create=function(t){console.info("You have move "+100*Data.score+" YUAN")},t.prototype.gameover=function(t){this._time.stop(),this._gesture.removeEvent()},t.prototype.counter=function(t){this._background.update(),console.debug("Input type:"+Data.type),1==Data.type&&(this.moveMoney(),Data.score++)},t.prototype.moveMoney=function(){console.log("move money and not stop"),egret.Tween.removeTweens(this._maskBg),this.resetPostion();var t=!1,e=300,i=100,n=egret.Ease.quintInOut,s=0,o=Data.getStageW()/2,a=1,r=1,h=0,g=0,_={x:this._maskBg.x+s,y:this._maskBg.y+o,alpha:g,rotation:h,scaleX:a,scaleY:r};egret.Tween.get(this._maskBg,{loop:t}).to(_,e,n).wait(i)},t.prototype.resetPostion=function(){this._maskBg.x=0,this._maskBg.y=0,this._maskBg.scaleX=1,this._maskBg.scaleY=1,this._maskBg.rotation=0,this._maskBg.alpha=1},t}();__reflect(Game.prototype,"Game");var Gesture=function(){function t(){this._symbol=["28","46","82","64","141","585","3","7","5","1","4321876","2345678"],this._symbolG=[0,0,3,3,5,5,1,1,2,2,4,4]}return t.prototype.addEvent=function(t){this._layer=t,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},t.prototype.removeEvent=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},t.prototype.mouseDown=function(t){this._layer.graphics.clear(),this._mouseDatas=[];var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._currentPoint=e},t.prototype.mouseMove=function(t){var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._layer.graphics.lineStyle(5,0),this._layer.graphics.moveTo(this._currentPoint.x,this._currentPoint.y),this._layer.graphics.lineTo(e.x,e.y),this._layer.graphics.endFill(),this._currentPoint=e},t.prototype.mouseUp=function(t){var e=new egret.Point(t.stageX,t.stageY);this._mouseDatas.push(e),this._layer.graphics.clear(),this.motion()},t.prototype.motion=function(){var t=[],e=0,i=this._mouseDatas.length;t.push(this._mouseDatas[e]);for(var n=0;i>n;n++)egret.Point.distance(this._mouseDatas[e],this._mouseDatas[n])>30&&(e=n,t.push(this._mouseDatas[e]));this._mouseDatas=t,this.parseDirection()},t.prototype.parseDirection=function(){this._dirsArr=[];for(var t=this._mouseDatas.length,e=0;t>e;e++)if(this._mouseDatas[e+1]){var i=this._mouseDatas[e],n=this._mouseDatas[e+1],s=i.y-n.y,o=egret.Point.distance(i,n),a=Math.asin(s/o),r=57.29578*a,h=this.quadrant(i,n),g=this.getDirByAngQuad(r,h);this._dirsArr.push(g)}var _=this.repDiff(this._dirsArr);console.log(_);var p=this.sweep(_);console.log("type: ",p),this.disEvent(p)},t.prototype.disEvent=function(t){Data.type=t,-1!=t&&egret.MainContext.instance.stage.dispatchEvent(new egret.Event("counter"))},t.prototype.sweep=function(t){for(var e=-1,i=-1,n=this._symbol.length,s=0;n>s;s++){var o=this.Levenshtein_Distance_Percent(this._symbol[s],t);o>i&&(i=o,e=this._symbolG[s])}return.4>i&&(e=-1),e},t.prototype.repDiff=function(t){for(var e="",i=t.length,n=0,s=0;i>s;s++)n!=t[s]&&(n=t[s],e+=t[s]);return e},t.prototype.getDirByAngQuad=function(t,e){switch(e){case 1:return 22.5>=t&&t>=0?1:67.5>=t&&t>22.5?8:7;case 2:return 22.5>=t&&t>=0?5:67.5>=t&&t>22.5?6:7;case 3:return-67.5>=t&&t>=-90?3:-22.5>=t&&t>-67.5?4:5;case 4:return-67.5>=t&&t>=-90?3:-22.5>=t&&t>-67.5?2:1}},t.prototype.quadrant=function(t,e){return e.x>=t.x?e.y<=t.y?1:4:e.y<=t.y?2:3},t.prototype.Levenshtein_Distance=function(t,e){var i,n,s,o,a,r=t.length,h=e.length,g=[];if(0==r)return h;if(0==h)return r;for(i=0;r>=i;i++)g[i]=[],g[i][0]=i;for(n=0;h>=n;n++)g[0][n]=n;for(i=1;r>=i;i++)for(s=t.charAt(i-1),n=1;h>=n;n++)o=e.charAt(n-1),a=s==o?0:1,g[i][n]=this.Minimum(g[i-1][n]+1,g[i][n-1]+1,g[i-1][n-1]+a);return g[r][h]},t.prototype.Levenshtein_Distance_Percent=function(t,e){var i=t.length>e.length?t.length:e.length,n=this.Levenshtein_Distance(t,e);return 1-n/i},t.prototype.Minimum=function(t,e,i){return e>t?i>t?t:i:i>e?e:i},t}();__reflect(Gesture.prototype,"Gesture");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=new egret.DisplayObjectContainer;this.addChild(t),this._game=new Game(t),this._game.start()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");